/* $Id: INSTALL.ja_utf8 620 2009-08-29 01:21:28Z hodaka $ */

==インストール手順==

１．梱包内容
    |
    +-- extra(プラグインが入っています)
    |	(xmobile、piCal用はhtml以下)
    |	(d3pipesブロック用はxoops_trust_path以下)
    |   *** smartyプラグイン4ファイル
    | (HDディストリの場合、smarty pluginは既にtrust側libsに入っています)
    |
    +-- html(公開側ファイルが入っています)
    |
    +-- xoops_trust_path(秘匿ファイルが入っています)

２．XOOPS_TRUST_PATH用ディレクトリの用意

    １）D3モジュールですので、XOOPS_ROOT_PATH以外にXOOPS_TRUST_PATH用ディレクトリを用意してパスをmainfile.phpに記述しておきます。
    ２）D3モジュールについて不明な方は「文系のためのXOOPS入門/D3モジュールとはなんなのか？」（http://xoops.kudok.com/d3.htm）が参考になります。

３．altsysモジュール（v0.55以上）を最初にインストールしておきます。

４．ファイルアップロード

    １）html以下のディレクトリ、ファイルをXOOPS_ROOT_PATH以下にアップします。
        ＊モジュールのディレクトリ名の変更は自由です。
    ２）xoops_trust_path以下のディレクトリ、ファイルを２で用意したXOOPS_TRUST_PATH用ディレクトリ以下にアップします。
        ＊隠し設定値を変更するには修正後のtrust/include/default/preferences.default.phpをpreferences.inc.phpとしてリネームします。
    ３）extra/html/class/smarty/plugins以下の4ファイルは下記にアップします。
        X2.0.x系は公開側class/smarty/plugins
        XCL2.1.x系はtrust側/libs/smartyplugins

５．[d]ブロック専用スタイルのアサイン（$xoops_block_header）[/d]

    ホダ塾ディストリを機に不要にしました。
    ブロックスタイルがモジュールスタイルより優先することは従来通りです。

６．インストール操作は他のモジュールと全く変わりません。通常のようにインストールしてください。


== アップグレード ==

１．v1.00 => v1.01
    １）旧root側、旧trust側ファイルとも全削除してから新ファイルをアップロードしてください。

    ２）モジュールアップデートします。

    ３）一般設定項目で、trackbackのSPAMチェック項目を変更しています。確認してください。

    ４）権限管理がフル改訂になってますので、「使い方１の３）パミッションの設定」を参考に再構築してください。

    ５）４)に関係してテンプレート変更が必要です。
        +--------------------------------------------------------------+
        | $currentUser.perm_name.xxxx => $currentUser.user_perm.xxxx   |
        +--------------------------------------------------------------+
        該当テンプレ：inc_entry.html、main_submit.html

    ６）smartyプラグイン名変更に伴うテンプレ修正
        +--------------------------------------------------+
        | mb_truncate => xoops_mb_truncate                 |
        +--------------------------------------------------+
        該当テンプレ：admin_approval_manager.html、main_details.html、main_submit.html

    ７）autodiscovery関連のテンプレ修正
        main_submit.htmlのtrackback url入力欄の肩に以下を追加
        +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
        | <input type="checkbox" name="autodiscovery" id="autodiscovery" value="1"<{if $form.autodiscovery_}> checked="checked"<{/if}> /><label for="autodiscovery"><{$smarty.const._MD_D3BLOG_LANG_AUTODISCOVER}></label> |
        +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

    ８）renameされたテンプレートをincludeするテンプレートの修正
        renameされたテンプレート	main_header.html => inc_header.html、main_entry_html => inc_entry.html、main_comment_form.html => inc_comment.html
        修正を要するテンプレート	main_archives.html、main_comment_edit.html、main_details.html、main_index.html、main_submit.html

    ９）トラックバックの日本語チェック用正規表現の修正
        一般設定の「日本語固有の文字パターン」を次のように書き換えてください。従来のパターンがEUC-JPにしか有効ではないためです。
        +---------------------------------+
        | [一-龠]+|[ぁ-ん]+|[ァ-ヴー]+    |
        +---------------------------------+

==使い方==

１．インストール直後に管理側で行うこと

    １）一般設定
        個別項目については後述

    ２）カテゴリの作成
        最低限一つのカテゴリが必要です。カテゴリーマネジャーで作成してください。

    ３）パミッションの設定
        管理者といえども権限を与えないと閲覧/書き込み権限はありません。
        「編集者」はオールマイティです。他人のエントリを編集できるのは編集者だけです。
        html書き込みをゲストに許可しないのが賢明です。
        カテゴリ単位での権限管理はできません。必要な場合は別のモジュールとしてインストールしてください。

    ４）ブロック管理/モジュールアクセス権限/言語定数管理
        altsysモジュールの機能を使います。最低限グループ別にモジュール権限を設定してください。
        すべてのブロックが複製可能です。双方のブロックのhtmlを使い分けたい場合はブロックのタイプをうまく利用してください。

    ５）CSSマネジャー
        イ）一般設定でダイナミックCSSを選択しない場合
            一旦、公開側cssディレクトリ777、その下にあるファイルには666のパミッションを与えます。
            その後cssマネジャーで必ず外部CSSファイルを書き出してください。
            書き出しが完了したらcssディレクトリ以下を元の読み込み専用644にします。
            .htaccessが可能なら同ディレクトリにある.htaccess.distを.htaccessにリネームしてください。
            ＊モジュール名をd3blog以外にした場合、外部cssを書き出さないとブロックにスタイルが効きませんので注意してください。

        ロ）ダイナミックcss
            xoopsへのアクセス頻度が上がりますので、インストール後のテストやスタイル調整時のみ使用することをお奨めします。調整終了後は公開側外部スタイルシートに切り替えてください。

    ６）テンプレート管理
        altsysモジュールの機能を使います。
        スタイルシートの編集が可能です。

    以上でモジュール使用が可能になりました。

２．weblog-1.42、weblogD3、xeblogからのインポート（データ移行）

    インポートマネジャーで以下の項目を引き継ぐことができます
    １）カテゴリ、エントリ、トラックバックのテーブルデータ
    ２）コメント、イベント通知
    ３）エントリ単位のコメント数、トラックバック数

    なお、インポート元のテーブル３データは元のまま維持されていますが、２，３を実行するとコメント、イベント通知データは元には戻れません。

３．承認管理

    承認が必要なエントリやトラックバックがあれば承認管理でその一覧が確認できますので、一括またはエントリ単位で承認・却下ができます。
    イベント通知設定しておくか、承認プラグインを内蔵してありますので承認モジュールをインストールしておくといいでしょう。

４．更新ping、トラックバック送受信

    １）更新pingの送信
        あらかじめ一般設定で更新ping送信先を指定しておきます。（隠し機能として投稿時に選択できることも可能ですがユーザーに使用させるのはお奨めしません）
        多くを指定すると時間がかかりますので、せいぜい4つくらいに止めましょう。
        投稿または編集時に「オプション欄の更新pingを送信する」をチェックしない限り送信しません。通常はoffです。むやみやたらに送信するのはやめましょう。

    ２）トラックバック送信
        投稿または編集時に「トラックバック/リンク先欄」に入力します。複数ある場合は1カ所ごとに改行します。
        指定したトラックバックリンク先へは一度しか送信しません。やむを得ず再送する場合は送信済みデータを削除した上で行ってください。
        AUTODISCOVER機能を追加しました（v1.01）。相手先のURLを記入すればtrackback urlを自動取得します。ただし、相手先がルール通り運用（embedded rdf）していればの話ですが。

    ３）トラックバック受信
        まず、ゲストに閲覧権限を与えてください。
        トラックバックに承認を必要とすることができます。一般設定で選択してください。その場合はイベント通知または承認モジュールなどを利用するといいでしょう。

    ４）トラックバックSPAM対策
        次のような機能があります。いずれも一般設定で選択してください。

        イ）タイトル、ブログ名がブランクのものを拒否する
            デフォルトでシステムに組み込んであります。設定する必要はありません。
        ロ）タイトル、ブログ名、要約欄に禁止用語が含まれるものを拒否する（1語ずつ改行）
        ハ）DNSBLチェック
            送信元のアドレスがブラックリストに登録されている場合拒否します。
        ニ）文中のurlチェック
            要約文中にurlの記載があれば指定したサーバーにブラックリスト登録されていないかどうかチェックします。
        ホ）文字パターンチェック
            マルチバイト使用時のみ有効です。
            unicodeの正規表現による文字パターンと必要文字数を指定します。
            タイトル、ブログ名、要約文中で、パターンに合致する文字数の合計が指定数に満たない場合拒否します。
            日本語の場合文字のパターンのデフォルトは、ひらがな、カタカナ、漢字の3種となっています。
        ヘ）正規表現によるチェック
        ホ）参照先言及チェック（v1.01で追加）
            当方のブログのurlについてブログページで言及してない場合は拒否します。（snoopyクラスで送信元ページを読み込みます）

    ５）一般設定で「チケット式トラックバックURLを使う」を選択した場合、
        - 相手はjavascript有効である必要がある
        - チケットの有効時間は1日
        - 一度使われたチケットは再利用できない
        - 埋込RDFのtrackbak_urlはチケット式ではない（つまり、__mode=rssなどのGET要求があっても対応できない。当然ですがautodiscovery要求に対応不可です）
        であることに留意してください。

        ＊作者としては、これは世のトラックバックルールから外れるのでお奨めではありません。
        ＊SPAM対策としては承認式あるいは４）に掲げた方策で十分です。それでも耐えきれなったときの最後の手段と考えてください。

５．エントリ単位の閲覧権限

    一般設定でエントリ毎に閲覧可能グループを指定できます。
    その際はデフォルトの許可グループを同時に指定してください。
    ただし、パミッション管理で閲覧権限のないグループは無効になります。

    エントリ単位で閲覧権限のないグループでも、メイン処理やブロックでタイトル・要約部分は閲覧可能になります。
    その場合は一般設定の「タイトル・要約部分は閲覧可能」を有効にしてください。

    １）留意事項
        この機能を、今までoffであったものを途中でonにする場合は注意が必要です。
        過去データのアクセス権は管理者のみだからです。phpmyadminなどで補正してください。

６．プラグイン

    下記モジュールのプラグインをextra以下に同梱しています。必要に応じてアップしてください。
    なかには使用ディレクトリ名に応じてリネームする必要があります。

    +----------------------------------------------------------------------+------------------+
    | モジュール名 | プラグイン                                            |      備考        |
    +--------------+-------------------------------------------------------+------------------+
    | xmobile      | extra/html/modules/xmobile/plugins/d3blog.php         | リネームが必要   |
    +--------------+-------------------------------------------------------+------------------+
    | piCal        | extra/html/modules/piCal/plugins/monthly/d3blog-date  | daily,weeklyなど |
    |			         |                                          d3blog-entry | 必要なものだけを |
    |              |                                                       | upすればいい     |
    +--------------+-------------------------------------------------------+------------------+
    | d3pipes      | extra/xoops_trsut_path/modules/d3pipes/joints/		     |                  |
    |              |                block/D3pipesBlockD3bloglist.class.php |                  |
    +--------------+-------------------------------------------------------+------------------+

    そのほかに下記のプラグインを内蔵しています。
    +--------------+-------------------------------------------------------+------------------+
    | d3forum      | xoops_trust_path/modules/d3blog/class/                | コメント統合時   |
    |              |                		d3blogD3commentEntry.class.php     | 注を参照         |
    +--------------+-------------------------------------------------------+------------------+
    | search       | xoops_trust_path/modules/d3blog/include/              |                  |
    |              |                                    search.inc.php     |                  |
    +--------------+-------------------------------------------------------+------------------+
    | whatsnew     | xoops_trust_path/modules/d3blog/include/              |                  |
    |              |                                    data.inc.php       |                  |
    +--------------+-------------------------------------------------------+------------------+

７.	d3forumコメント統合の利用（d3forum-0.83以上が必要）
        一般設定で対象d3forumとforum_idを指定してください。
        コメント元へのURIを自動取得できます。
        フォーラム編集時「コメント統合時の参照方法」に下記フォーマットで入力します。

        +-------------------------------------------------------------+
        | ディレクトリ名::d3blogD3commentEntry::trust側ディレクトリ名 |
        +-------------------------------------------------------------+

８．wysiwygエディタ

    FCKeditorが選択できます。
    ただし、html権限のあるグループしか使えません。

    同梱しませんので、ホダ塾ディストリビューション（http://hodajuku.sourceforge.net/）から「Package_hd for XCL2.1」の最新版からダウンロードしてください。
    html/common/fckeditorディレクトリ毎サーバーにアップします。

９．画像アップロード

    d3blog自体には機能がありません。
    イメージマネジャーまたはイメージマネジャー統合機能などを活用してください。

以上